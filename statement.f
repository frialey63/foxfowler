      PROGRAM STATEMENT

C      ASHMOLE SCHOOL PROJECT P.PARLETT 18 FEB
C      PROGRAM WK19 04

C     "INITIALISE ARRAYS AND SPECIAL VARIABLES"
      EXTERNAL DIGITS
      INTEGER ATEMPT
      COMMON ATEMPT
      DIMENSION BANKYR(2), BRNAME (3), ANAME(7),
     &BALMTH (3), TRANMH (3), TRANDE (7), EOF (2),
     &CSNAME (7), ABVMTH (3), BELMTH(3)
      DIMENSION BELDE(7)
      INTEGER CODENO, SHEETN, BALDT, TRANDT,
     &ACCTNO, F, ABVDT, BELDT
      DATA EOF(1),EOF(2)/4HZZZZ,4HZZZZ/

      DIMENSION X(1)
      DATA X(1)/1HX/

C     "CHECK USER"
      CALL USERCHECK
C     "VALID USER"

      WRITE (1,1)
      J = 0
      IABBRE = 0
C     "REQUEST CUSTOMER DETAILS"
      WRITE (1,2)
  500 READ (3,3) CSNAME
      DO 501 N=1,7
      CALL FOURCHECK(CSNAME(N), IRESLT)
      IF (IRESLT.EQ.0) GO TO 500
  501 CONTINUE
      WRITE (1,4)
  510 ATEMPT = 0
      CALL FTRAP(DIGITS)
      READ (3,5) ACCTNO
      CALL FRESET
      IF(ATEMPT.GT.0) GO TO 510

C     "FIND CUSTOMER"
   21 READ (4,6) BANKYR
      DO 80 N=1,2
      I = 4
      CALL COMP(I,BANKYR(N), 1, EOF(N),1)
      IF(I.NE.4) GO TO 81
   80 CONTINUE
      GO TO 15
   81 READ (4,7) BRNAME, ANAME, CODENO,
     &SHEETN, BALFWD, BALDT, BALMTH
      DO 82 M=1,7
      I = 4
      CALL COMP(I,ANAME(M), 1,CSNAME(M), 1)
      IF (I.NE.4) GO TO 83
   82 CONTINUE
      IF(CODENO.EQ.ACCTNO) GO TO 22
      WRITE (1,20)
      STOP
   83 WRITE (2,8) BANKYR
      WRITE (2,9) BRNAME, ANAME, CODENO,
     &SHEETN, BALFWD, BALDT, BALMTH
   14 READ (4,11) TRANDT
      WRITE (2,71) TRANDT
      IF (TRANDT.EQ.99) GO TO 21
      READ (4,12) TRANMH, TRANDE, DEBS, CREDS
      WRITE (2,13) TRANMH, TRANDE, DEBS, CREDS
      GO TO 14     
C     "END OF FILE OLD"
   15 WRITE (2,8) BANKYR
      IF (J.EQ.1) GO TO 17
      WRITE (1,16) CSNAME, ACCTNO
   17 STOP
      WRITE (1,201)

C     "OUTPUT OF A STATEMENT"
   22 J = 1
      WRITE (1,23)
      WRITE (1,25) CODENO, SHEETN
      WRITE (1,26) ANAME
      WRITE (1,27) BANKYR, BRNAME
      WRITE (1,28)
      WRITE (1,30) BALDT, BALMTH, BALFWD
      TOTAL = BALFWD

C     "OUTPUT OF TRANSACTIONS"
      F = 0
      ABVDT = 99
      DO 130 L=1,3
      I = 1
C     CALL COPY(I,ABVMTH(L),1,1HX, 1)
      CALL COPY(I,ABVMTH(L),1,X, 1)
  130 CONTINUE
      READ (4,11) TRANDT
      IF (TRANDT.EQ.99) GO TO 61
      READ (4,12) TRANMH, TRANDE, DEBS, CREDS
   60 READ (4,11) BELDT
      IF (BELDT.EQ.99) GO TO 63
      READ (4,12) BELMTH, BELDE, BEDEBS, BCREDS

C     "DECIDE WHICH TRANSACTION OUTPUT ROUTINE TO USE"
      IF (TRANDT.EQ.ABVDT) GO TO 34
   35 IF (TRANDT.EQ.BELDT) GO TO 36
      GO TO 44
   34 DO 90 L=1,3
      I= 1
      CALL COMP(I, TRANMH (L) , 1, ABVMTH (L), 1)
      IF(I.NE.1) GO TO 35
   90 CONTINUE
      GO TO 37
   36 DO 95 L=1,3
      I = 1
      CALL COMP(I,TRANMH(L),1, BELMTH(L),1)
      IF (I.NE.1) GO TO 37
   95 CONTINUE
      GO TO 40
   37 IF (TRANDT.EQ.BELDT) GO TO 38
   39 GO TO 49
   38 DO 100 L=1,3
      I = 1
      CALL COMP(I,TRANMH(L),1,BELMTH(L),1)
      IF (I.NE.1) GO TO 39
  100 CONTINUE
      GO TO 54

C     "FIRST TRANSACTION OUTPUT ROUTINE"
   40 IF (DEBS.EQ .- 1.0) GO TO 42
      TOTAL = TOTAL - DEBS
      WRITE (1,41) TRANDT, TRANMH, TRANDE, DEBS
      GO TO 58
   42 TOTAL = TOTAL + CREDS
      WRITE (1,43) TRANDT, TRANMH, TRANDE, CREDS
      GO TO 58

C     "SECOND TRANSACTION OUTPUT ROUTINE"
   44 IF (DEBS.EQ .- 1.0) GO TO 46
      TOTAL = TOTAL - DEBS
      WRITE (1,45) TRANDT, TRANMH, TRANDE,
     &DEBS, TOTAL
      GO TO 48
   46 TOTAL = TOTAL + CREDS
      WRITE (1,47) TRANDT, TRANMH, TRANDE,
     &CREDS, TOTAL
   48 IF (F.EQ.0) GO TO 58
      GO TO 66

C     "THIRD TRANSACTION OUTPUT ROUTINE"
   49 IF (DEBS.EQ .- 1.0) GO TO 51
      TOTAL = TOTAL - DEBS
      WRITE (1,50) TRANDE, DEBS, TOTAL
      GO TO 53
   51 TOTAL = TOTAL + CREDS
      WRITE (1,52) TRANDE, CREDS, TOTAL
   53 IF (F.EQ.0) GO TO 58
      GO TO 66

C     "FOURTH TRANSACTION OUTPUT ROUTINE"
   54 IF(DEBS.EQ .- 1.0) GO TO 56
      TOTAL = TOTAL - DEBS
      WRITE (1,55) TRANDE, DEBS
      GO TO 58
   56 TOTAL = TOTAL + CREDS
      WRITE (1,57) TRANDE, CREDS
      GO TO 58

C     "OUTPUT OF A TRANSACTION LINE FINISHED PREPARE FOR NEXT DECISION"
   58 ABVDT = TRANDT
      DO 110 L=1,3
      I = 1
      CALL COPY(I,ABVMTH(L), 1,TRANMH(L),1)
  110 CONTINUE
      TRANDT = BELDT
      DO 105 L=1,3
      I = 1
      CALL COPY(I,TRANMH(L), 1,BELMTH(L),1)
  105 CONTINUE
      DO 115 L=1,7
      I = 4
      CALL COPY(I,TRANDE(L),1,BELDE(L),1)
  115 CONTINUE
      DEBS = BEDEBS
      CREDS = BCREDS
      GO TO 60
C     "FIRST EOF CASE"
   61 WRITE (1,62)
      K = 0
      IABBRE = 1
      GO TO 72

C     "SECOND EOF CASE"
   63 IF (TRANDT.EQ.ABVDT) GO TO 64
   65 F = 1
      GO TO 44
   64 DO 120 L=1,3
      I = 1
      CALL COMP(I,TRANMH(L),1,ABVMTH(L),1)
      IF (I.NE.1) GO TO 65
  120 CONTINUE
      F= 1
      GO TO 49
      
C     "END UF STATEMENT OUTPUT"
   66 WRITE (1,67)
      K = 1
      GO TO 72
   73 SHEETN = SHEETN + 1
      BALFWD = TOTAL
      BALDT = TRANDT
      DO 125 L=1,3
      I = 1
      CALL COPY(I, BALMTH(L),1,TRANMH(L),1)
  125 CONTINUE
  250 WRITE (2,8) BANKYR
      WRITE (2,9) BRNAME, ANAME, CODENO,
     &SHEETN, BALFWD, BALDT, BALMTH
      TRANDT = 99
      WRITE (2,71) TRANDT
      GO TO 21
   72 WRITE (1,74)
      IF(K.EQ.1) GO TO 73
      IF (IABBRE.EQ.1) GO TO 250
      GO TO 66
      STOP

    1 FORMAT (1H /1H /1H /1H , 21HRECORD STATEMENT MODE)
    2 FORMAT (1H /1H /1H , 27HPLEASE TYPE CUSTOMER'S NAME)
    3 FORMAT (7A4)
    4 FORMAT (1H ,30HPLEASE TYPE ACCOUNT CODENUMBER)
    5 FORMAT (I10)
    6 FORMAT (2A4)
    7 FORMAT (3A4,7A4,I10,I4,F11.0,I2,3A1)
    8 FORMAT (1H ,2A4)
    9 FORMAT (1H ,3A4,7A4,I10,I4,F11.2,I2,3A1)
   11 FORMAT (I2)
   12 FORMAT (3A1,7A4,2F10.0)
   13 FORMAT (1H ,3A1,7A4,2F10.2)
   16 FORMAT (1H ,15HERROR-CUSTOMER ,7A4,
     &16H ACCOUNT NUMBER , I10,12H NOT ON FILE)
   20 FORMAT (1H ,24HERROR-ACCOUNT CODENUMBER,
     &30H DOESN'T MATCH CUSTOMER'S NAME)
   23 FORMAT (1H /1H /1H /1H /1H ,22X, 25HDEPOSIT ACCOUNT STATEMENT)
   25 FORMAT (1H /1H ,9X,I10,32X, 5HSHEET, 1X,I4)
   26 FORMAT (1H /1H ,9X,7A4,
     &33H ESQ. IN ACCOUNT WITH FOX, FOWLER/
     &1H ,38X,21HAND COMPANY (TAUNTON))
   27 FORMAT (1H /1H ,8X,4HYEAR,1X,2A4, 21X,3A4,7H BRANCH)
   28 FORMAT (1H /1H ,5H DATE,3X,7HDETAILS,21X,
     &6HDEBITS,5X, 7HCREDITS, 4X, 7HBALANCE/1H )
   30 FORMAT (1H ,1X,I2, 1X, 3A1, 1X, 15HBALANCE FORWARD,36X,F11.2)
   41 FORMAT (1H , 1X, I2, 1X,3A1, 1X,7A4, 1X,F10.2)
   43 FORMAT (1H , 1X, I2, 1X, 3A1, 1X,7A4, 12X, F10.2)
   45 FORMAT (1H ,1X, I2, 1X,3A1, 1X, 7A4,F10.2,12X,F11.2)
   47 FORMAT (1H ,1X,I2, 1X, 3A1, 1X, 7A4,12X,F10.2,1X,F11.2)
   50 FORMAT (1H ,8X,7A4,1X,F10.2,12X,F11.2)
   52 FORMAT (1H ,8X,7A4,12X,F10.2,1X,F11.2)
   55 FORMAT (1H ,8X,7A4,1X,F10.2)
   57 FORMAT (1H ,8X,7A4,12X,F10.2)
   62 FORMAT (1H /1H /1H /1H /1H /1H ,
     &36HNO TRANSACTIONS SINCE LAST STATEMENT)
   67 FORMAT (1H /1H /1H /1H )
   71 FORMAT (1H ,I2)
   74 FORMAT (1H ,8X,
     &33HABBREVIATIONS CD - CASH DISPENSER/
     &1H ,22X,18HDC - DIRECT CREDIT/
     &1H ,22X,17HDD - DIRECT DEBIT/
     &1H ,22X,13HDV - DIVIDEND/
     &1H,22X,19HSO - STANDING ORDER/
     &1H,22X, 13HTR - TRANSFER/
     &1H ,22X,23HOD - OVER DRAWN BALANCE)
  201 FORMAT (1H /1H /1H /1H )

      END
